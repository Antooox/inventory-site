<!doctype html>
<html lang="sv">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Inventory — Simple (prod)</title>
<style>
  :root{--bg:#f6f7f9;--card:#fff;--muted:#64748b;--accent:#0ea5a4}
  html,body{height:100%;margin:0;background:var(--bg);font-family:Inter,Arial,Helvetica,sans-serif;color:#0b1220}
  .wrap{max-width:980px;margin:28px auto;padding:18px}
  .card{background:var(--card);padding:18px;border-radius:10px;box-shadow:0 10px 30px rgba(10,20,40,0.06)}
  h1{margin:0 0 6px;font-size:20px}
  .lead{margin:0 0 12px;color:var(--muted);font-size:14px}
  .formgrid{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px}
  .formgrid > *{flex:1 1 160px;min-width:140px}
  input[type="text"], input[type="date"]{
    width:100%;box-sizing:border-box;padding:10px;border-radius:8px;border:1px solid #dfe8ef;background:#fff;color:#0b1220;font-size:14px
  }
  .controls{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  button{padding:10px 12px;border-radius:8px;border:0;cursor:pointer;font-weight:600}
  .btn-primary{background:var(--accent);color:#fff}
  .btn-ghost{background:#eef2f7;color:#0b1220;border:1px solid #e6eef6}
  .btn-danger{background:#ef4444;color:#fff}
  .btn-small{padding:6px 8px;font-size:13px;border-radius:6px}
  table{width:100%;border-collapse:collapse;margin-top:12px}
  th,td{padding:10px 8px;border-bottom:1px solid #f0f4f8;text-align:left;font-size:14px}
  thead th{font-size:13px;color:var(--muted)}
  tr.selected{background:rgba(14,165,164,0.06)}
  .small{font-size:13px;color:var(--muted)}
  .toolbar{display:flex;gap:8px;align-items:center;justify-content:flex-end;margin-top:8px}
  @media (max-width:640px){ .formgrid{flex-direction:column} .toolbar{flex-direction:column;align-items:stretch} }
</style>
</head>
<body>
  <div class="wrap">
    <div class="card" role="region" aria-label="Simple inventory">
      <h1>Simple inventory</h1>
      <p class="lead">Lägg till objekt, markera för att ta bort och exportera som CSV vid behov. Data sparas lokalt i din webbläsare.</p>

      <div class="formgrid" role="form" aria-label="Add object form">
        <div>
          <label for="objInput" class="small">Object</label>
          <input id="objInput" type="text" placeholder="Ex: Ventil ABC-123" aria-label="Object">
        </div>
        <div>
          <label for="dateInput" class="small">Added date</label>
          <input id="dateInput" type="date" aria-label="Added date">
        </div>

        <div style="display:flex;flex-direction:column;justify-content:flex-end">
          <div class="controls" style="justify-content:flex-end;">
            <button id="addBtn" class="btn-primary" type="button">Add to list</button>
          </div>
        </div>
      </div>

      <table role="table" aria-live="polite" aria-label="Items table">
        <thead>
          <tr>
            <th style="width:36px"><input id="selectAll" type="checkbox" aria-label="Select all rows" /></th>
            <th>Object</th>
            <th>Added date</th>
            <th style="width:160px">Added at</th>
          </tr>
        </thead>
        <tbody id="tbody">
          <tr><td colspan="4" class="small">Inga poster ännu</td></tr>
        </tbody>
      </table>

      <div class="toolbar" role="toolbar" aria-label="Actions">
        <button id="removeBtn" class="btn-danger btn-small" type="button">Remove selected</button>
        <button id="undoBtn" class="btn-ghost btn-small" type="button">Undo remove</button>
        <button id="exportBtn" class="btn-ghost btn-small" type="button">Export CSV</button>
      </div>

      <p class="small" style="margin-top:12px">Tips: om du vill dela listan mellan kollegor, nästa steg är att lägga upp filen på en HTTPS-host och ev. lägga till en liten serverless-endpoint.</p>
    </div>
  </div>

<script>
(function(){
  const KEY = 'simple_inventory_prod_v1';
  const objInput = document.getElementById('objInput');
  const dateInput = document.getElementById('dateInput');
  const addBtn = document.getElementById('addBtn');
  const removeBtn = document.getElementById('removeBtn');
  const undoBtn = document.getElementById('undoBtn');
  const exportBtn = document.getElementById('exportBtn');
  const tbody = document.getElementById('tbody');
  const selectAll = document.getElementById('selectAll');

  let items = [];
  let lastRemoved = []; // store removed items for undo

  // init date to today
  function setToday(){
    const d = new Date();
    dateInput.value = d.toISOString().slice(0,10);
  }

  function load(){
    try{ items = JSON.parse(localStorage.getItem(KEY) || '[]'); } catch(e){ items = []; }
    render();
  }

  function save(){
    localStorage.setItem(KEY, JSON.stringify(items));
  }

  function render(){
    tbody.innerHTML = '';
    if(items.length === 0){
      const tr = document.createElement('tr');
      tr.innerHTML = '<td colspan="4" class="small">Inga poster ännu</td>';
      tbody.appendChild(tr);
      selectAll.checked = false;
      selectAll.indeterminate = false;
      return;
    }
    items.forEach((it, idx) => {
      const tr = document.createElement('tr');
      if(it.selected) tr.classList.add('selected');
      tr.innerHTML = `
        <td><input type="checkbox" class="row-check" data-index="${idx}" ${it.selected ? 'checked' : ''} aria-label="Select row ${idx+1}" /></td>
        <td>${escapeHtml(it.object)}</td>
        <td>${escapeHtml(it.addedDate)}</td>
        <td style="color:#64748b;font-size:13px">${escapeHtml(it.addedAt)}</td>
      `;
      tbody.appendChild(tr);
    });
    updateSelectAllCheckbox();
  }

  function escapeHtml(s){ return String(s==null?'':s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

  // Add
  addBtn.addEventListener('click', () => {
    const obj = objInput.value.trim();
    const addedDate = dateInput.value || '';
    if(!obj){ alert('Fyll i Object'); objInput.focus(); return; }
    const item = {
      id: 'id-' + Date.now() + '-' + Math.random().toString(36).slice(2,6),
      object: obj,
      addedDate: addedDate,
      addedAt: new Date().toLocaleString(),
      selected: false
    };
    items.push(item);
    save();
    render();
    objInput.value = '';
    setToday();
    objInput.focus();
  });

  // Remove selected
  removeBtn.addEventListener('click', () => {
    const selected = items.filter(i => i.selected);
    if(selected.length === 0){ alert('Markera minst en rad att ta bort'); return; }
    if(!confirm(`Ta bort ${selected.length} markerade poster?`)) return;
    // store for undo
    lastRemoved = selected.map(i => Object.assign({}, i));
    items = items.filter(i => !i.selected);
    save(); render();
  });

  // Undo remove
  undoBtn.addEventListener('click', () => {
    if(!lastRemoved || lastRemoved.length === 0){ alert('Inget att ångra'); return; }
    // put them back at end
    items = items.concat(lastRemoved.map(i => Object.assign({}, i, { selected: false })));
    lastRemoved = [];
    save(); render();
  });

  // Select row checkbox toggle (event delegation)
  tbody.addEventListener('change', (e) => {
    const cb = e.target.closest('.row-check');
    if(!cb) return;
    const idx = Number(cb.dataset.index);
    items[idx].selected = !!cb.checked;
    save(); render();
  });

  // select all
  selectAll.addEventListener('change', () => {
    const v = !!selectAll.checked;
    items = items.map(i => Object.assign({}, i, { selected: v }));
    save(); render();
  });

  function updateSelectAllCheckbox(){
    if(items.length === 0){ selectAll.checked = false; selectAll.indeterminate = false; return; }
    const checkedCount = items.filter(i => i.selected).length;
    selectAll.checked = checkedCount === items.length;
    selectAll.indeterminate = checkedCount > 0 && checkedCount < items.length;
  }

  // Export CSV (exports current visible items)
  exportBtn.addEventListener('click', () => {
    if(items.length === 0){ alert('Inga poster att exportera'); return; }
    const hdr = ['Object','AddedDate','AddedAt'];
    const rows = items.map(it => [it.object, it.addedDate, it.addedAt].map(cell => '"' + String(cell||'').replace(/"/g,'""') + '"').join(','));
    const csv = [hdr.join(',')].concat(rows).join('\n');
    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'inventory_export.csv';
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
  });

  // Keyboard: Enter in text field triggers Add
  objInput.addEventListener('keydown', (e) => {
    if(e.key === 'Enter'){ e.preventDefault(); addBtn.click(); }
  });

  // initial
  setToday();
  load();

  // expose for debug
  window.__simpleInventoryProd = { getItems: () => items, clear: () => { items=[]; save(); render(); } };
})();
</script>
</body>
</html>
